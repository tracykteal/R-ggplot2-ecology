---
layout: topic
title: Data visualisation with ggplot2
subtitle: Visualising data in R with ggplot2 package
minutes: 60
---

<!---
show hide magic

<style> div.hidecode + pre {display: none} div.hidecode {color: #337ab7}</style><script> doclick=function(e){ e.nextSibling.nextSibling.style.display = e.nextSibling.nextSibling.style.display === "block" ? "none" : "block"; }</script>
-->

```{r}
knitr::opts_chunk$set(fig.keep='last')
```

```{r setup, echo=FALSE, purl=FALSE}
source("setup.R")
```

Authors: **Mateusz Kuzak**, **Diana Marek**, **Hedi Peterson**, **Tracy Teal**



#### Disclaimer

We will here using functions of ggplot2 package. There are basic ploting
capabilities in basic R, but ggplot2 adds more powerful plotting capabilities.

> ### Learning Objectives
>
> -	Visualise some of the
>[mammals data](http://figshare.com/articles/Portal_Project_Teaching_Database/1314459)
>from Figshare [surveys.csv](http://files.figshare.com/1919744/surveys.csv)
> -	Understand how to plot these data using R ggplot2 package. For more details
>on using ggplot2 see
>[official documentation](http://docs.ggplot2.org/current/).
> -	Building step by step complex plots with ggplot2 package

Load required libraries

```{r}
# plotting package
library(ggplot2)
```

A great resource for examples of Graphs with ggplot2  
http://www.cookbook-r.com/Graphs/

A good presentation by Karthik Ram on ggplot2
https://github.com/datacarpentry/R-ecology/blob/gh-pages/ref/ggplot.pdf


We're going to work with the survey data with the NAs omitted

Let's just make sure we have the right data


Load data directly from figshare.

```{r}
surveys_raw <- read.csv("http://files.figshare.com/1919744/surveys.csv")
```

Remove any rows that have NAs in them
```{r}
surveys_complete <- surveys[complete.cases(surveys), ]
```

Only keep the species where there are weights associated with them
```{r}
surveys_complete$species <- factor(surveys_complete$species)
```

Now we'll work with 'surveys_complete'

> Make simple scatter plot of `hindfoot_length` (in millimeters) as a function of
> `weight` (in grams), using basic R plotting capabilities.

```{r}
plot(x=surveys_complete$weight, y=surveys_complete$hindfoot_length)
```

## Plotting with ggplot2

We will make the same plot using `ggplot2` package.

`ggplot2` is a plotting package that makes it sipmple to create complex plots
from data in a dataframe. It uses default settings, which help creating
publication quality plotts with minimal amount of settings and tweaking.

With ggplot graphics are build step by step by adding new elements.

To build a ggplot we need to:

- bind plot to a specific data frame

```{r, eval=FALSE}
ggplot(surveys_complete)
```

- define aestetics (`aes`), that maps variables in the data to axes on the plot
     or to plotting size, shape color, etc.,

```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length))
```

- add `geoms` -- graphical representation of the data in the plot (points,
     lines, bars). To add a geom to the plot use `+` operator:

```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length)) +
  geom_point()
```

## Modifying plots

- change the size of the shapes

```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length)) +
  geom_point(size=3)
```

- you can also add transparency (alpha) which is useful if there are a lot of points
```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length)) +
  geom_point(alpha=0.3)
```

- add a title
```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length)) +
  geom_point(alpha=0.3) +
  ggtitle("Weight by hindfoot")
```

- adding colors

```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length)) +
  geom_point(color="blue")
```

- let's add color by species

```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length, color=species)) +
  geom_point()
```

Here we're saying to use the 'species' category to decide the color of each dot.
We could also do it by, say, plot. Try this. 

- we can do the color by species and the shape by sex

```{r}
ggplot(surveys_complete, aes(x = weight, y = hindfoot_length, color=species)) +
  geom_point(aes(shape=sex))
```

# Exercise

This has all been a lot of data, and it's hard to see things, so let's just do
the plotting for three species

- Use subset to get the survey data for just the species NL, PE and SF and 
call it surveys_s3

- Plot weight by hindfoot length for just this data. Make each species a 
different color and the sex a different shape.

- Bonus: Google and figure out how to create axis labels


## Plotting data in different regions

We can separate out the three species in our plot


```{r}
ggplot(surveys_s3, aes(x = weight, y = hindfoot_length, color=species)) +
  geom_point(aes(shape=sex)) +
  facet_grid(species ~ .)

```




